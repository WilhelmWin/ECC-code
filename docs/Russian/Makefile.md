# üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ —Å–±–æ—Ä–∫–∏
## üîç –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π Makefile –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ ECC –∏ ASCON, —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –ª–∏–Ω–∫—É–µ—Ç –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã client –∏ server.
## üîß –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ —Ñ–ª–∞–≥–∏
```make
CC = gcc
CFLAGS = -Wall -Wextra -O2 -fstack-protector-strong -fPIE -D_FORTIFY_SOURCE=2
LDFLAGS = -pie -Wl,-z,relro -Wl,-z,now
```
- `CC`: –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π C-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (GCC).
- `CFLAGS`: —Ñ–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - `Wall -Wextra`: –≤–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.
  - `O2`: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è.
  - `fstack`-protector-strong: –∑–∞—â–∏—Ç–∞ —Å—Ç–µ–∫–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è.
  - `fPIE` –∏ `-pie`: –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã (–¥–ª—è ASLR).
  - `D_FORTIFY_SOURCE=2`: –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## üéØ –ù–∞–∑–≤–∞–Ω–∏—è —Ü–µ–ª–µ–≤—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
```make
SERVER_TARGET = server
CLIENT_TARGET = client
```
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–º–µ–Ω–∞ –∏—Ç–æ–≥–æ–≤—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤.
## üìÅ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤
```make
ASCON_DIR = ASCON
```
- –ö–æ–¥ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ASCON –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ ASCON.
## üß© –ò—Å—Ö–æ–¥–Ω—ã–µ –∏ –æ–±—ä–µ–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
### ECC
```make
ECC_SRC = ECC.c
ECC_OBJ = ECC.o
```
- –û–¥–∏–Ω –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è ECC.

- –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª.

### ASCON
```make
ASCON_SRC = $(ASCON_DIR)/aead.c
ASCON_OBJ = $(ASCON_SRC:.c=.o)
```
- –ò—Å—Ö–æ–¥–Ω–∏–∫ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è ASCON.
- –ü—É—Ç—å –∫ –æ–±—ä–µ–∫—Ç–Ω–æ–º—É —Ñ–∞–π–ª—É —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### Server / Client
```make
SERVER_SRC = server.c session.c drng.c error.c
CLIENT_SRC = client.c session.c drng.c error.c
```
- Server –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: `server.c`, –æ–±—â–∏–π `session.c`, –ì–°–ß `drng.c` –∏ –æ—à–∏–±–∫–∏ `error.c`.

- Client –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: `client.c`, `session.c` –∏ `drng.c`, `error.c`.
```make
SERVER_OBJ = $(SERVER_SRC:.c=.o)
CLIENT_OBJ = $(CLIENT_SRC:.c=.o)
COMMON_OBJ = session.o drng.o error.o
```
- –û–±—ä–µ–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤.

## üìö –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```make
LIBECC = libecc.a
LIBASCON = libascon.a
LIBRARIES = $(LIBECC) $(LIBASCON)
```
- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –ª–∏–Ω–∫–æ–≤–∫–µ –∫–æ–Ω–µ—á–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤.

## üß∑ –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ–∑–∞–≤–∏—Å–∏–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```make
ifeq ($(OS), Windows_NT)
LDFLAGS = -lws2_32
RM = del /f /q
NULL = nul
else
LDFLAGS =
RM = rm -f
NULL = /dev/null
endif
```
–£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –û–°:

- –õ–∏–Ω–∫–æ–≤–æ—á–Ω—ã–µ —Ñ–ª–∞–≥–∏ (–≤ Windows –Ω—É–∂–µ–Ω Winsock ws2_32).

- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (rm –ø—Ä–æ—Ç–∏–≤ del).

- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ "–Ω–∏—á—Ç–æ" (nul vs /dev/null).

## üõ† –¶–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```make
all: $(LIBRARIES) $(SERVER_TARGET) $(CLIENT_TARGET) postbuild
```
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –ö–æ–º–ø–∏–ª—è—Ü–∏—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.

- –õ–∏–Ω–∫–æ–≤–∫—É –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞.

- –û—á–∏—Å—Ç–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏.

## üì¶ –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
```make
$(LIBECC): $(ECC_OBJ)
ar rcs $@ $^

$(LIBASCON): $(ASCON_OBJ)
ar rcs $@ $^
```
- `ar rcs`: –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ .a (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).

## üîó –õ–∏–Ω–∫–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
```make
$(SERVER_TARGET): $(SERVER_OBJ) $(LIBRARIES)
$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

$(CLIENT_TARGET): $(CLIENT_OBJ) $(LIBRARIES)
$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)
```
- –õ–∏–Ω–∫—É–µ—Ç –∫–∞–∂–¥—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª —Å –µ–≥–æ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ –Ω—É–∂–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏.

## üß± –ü—Ä–∞–≤–∏–ª–æ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```make
%.o: %.c
$(CC) $(CFLAGS) -c $< -o $@
```
- –®–∞–±–ª–æ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç `.c` –≤ `.o`.
## üßº –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
```make
postbuild:
ifeq ($(OS), Windows_NT)
-$(RM) ECC.o session.o drng.o error.o
-$(RM) ASCON\\aead.o ASCON\\printstate.o
-$(RM) server.o client.o
-$(RM) $(LIBRARIES)
else
$(RM) $(ECC_OBJ) $(COMMON_OBJ) $(ASCON_OBJ) $(SERVER_OBJ)
$(RM) $(CLIENT_OBJ) $(LIBRARIES)
endif
```
- –£–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏.

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–°.

## üßΩ –ö–æ–º–∞–Ω–¥—ã –æ—á–∏—Å—Ç–∫–∏
### **`make clean`**
```make
clean:
ifeq ($(OS), Windows_NT)
-$(RM) ASCON\\aead.o ASCON\\printstate.o
-$(RM) $(LIBRARIES)
-$(RM) $(SERVER_TARGET) $(CLIENT_TARGET) *.exe
else
$(RM) $(ASCON_DIR)/*.o $(LIBRARIES) $(SERVER_TARGET) $(CLIENT_TARGET)
$(RM) $(ECC_OBJ) $(COMMON_OBJ)  $(SERVER_OBJ) $(CLIENT_OBJ)
endif
```
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç–Ω—ã–µ –∏ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã.

### **`make distclean`**
```make
distclean:
ifeq ($(OS), Windows_NT)
-$(RM) *~ *.bak
else
$(RM) *~ *.bak
endif
```
- –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, *~, *.bak).